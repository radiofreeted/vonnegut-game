<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LEGODREAMS</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; }
        #gameCanvas { position: absolute; top: 0; left: 0; }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let gameState = 'loading';
        let currentLevel = 1;
        let playerScore = 0;
        let computerScore = 0;

        let player = { x: 50, y: canvas.height / 2, width: 30, height: 50 };
        let computer = { x: canvas.width - 80, y: canvas.height / 2, width: 30, height: 50 };

        // Characters and backgrounds arrays remain the same as before

        const loadedImages = {
            characters: new Array(5),
            backgrounds: new Array(5)
        };

        function loadImages() {
            let loadedCount = 0;
            const totalImages = characters.length + backgrounds.length;

            function onLoad() {
                loadedCount++;
                if (loadedCount === totalImages) {
                    gameState = 'title';
                    draw();
                }
            }

            characters.forEach((char, index) => {
                const img = new Image();
                img.onload = onLoad;
                img.src = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(char.svg);
                loadedImages.characters[index] = img;
            });

            backgrounds.forEach((bg, index) => {
                const img = new Image();
                img.onload = onLoad;
                img.src = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(bg.svg);
                loadedImages.backgrounds[index] = img;
            });
        }

        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (gameState === 'playing') {
                const touch = e.touches[0];
                player.x = touch.clientX - player.width / 2;
                player.y = touch.clientY - player.height / 2;
            } else if (gameState === 'title') {
                gameState = 'playing';
                startGame();
            }
        });

        function startGame() {
            currentLevel = 1;
            playerScore = 0;
            computerScore = 0;
            resetPositions();
        }

        function update() {
            if (gameState === 'playing') {
                const dx = player.x - computer.x;
                const dy = player.y - computer.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                computer.x += dx / distance;
                computer.y += dy / distance;

                if (checkCollision(player, computer)) {
                    playerScore++;
                    resetPositions();
                }

                if (computerTouchesPlayer()) {
                    computerScore++;
                    resetPositions();
                }

                if (playerScore === 5 || computerScore === 5) {
                    if (playerScore > computerScore) {
                        currentLevel++;
                        if (currentLevel > 5) {
                            gameState = 'gameOver';
                        } else {
                            resetGame();
                        }
                    } else {
                        gameState = 'gameOver';
                    }
                }
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (gameState === 'loading') {
                drawLoadingScreen();
            } else if (gameState === 'title') {
                drawTitleScreen();
            } else if (gameState === 'playing') {
                drawBackground();
                drawCharacter(player.x, player.y, loadedImages.characters[currentLevel - 1]);
                drawCharacter(computer.x, computer.y, loadedImages.characters[currentLevel - 1]);
                drawScore();
            } else if (gameState === 'gameOver') {
                drawGameOver();
            }
        }

        function drawBackground() {
            ctx.drawImage(loadedImages.backgrounds[currentLevel - 1], 0, 0, canvas.width, canvas.height);
        }

        function drawCharacter(x, y, characterImg) {
            ctx.drawImage(characterImg, x, y, player.width, player.height);
        }

        function drawScore() {
            ctx.fillStyle = 'white';
            ctx.font = '24px Arial';
            ctx.fillText(`Player: ${playerScore} Computer: ${computerScore}`, 10, 30);
        }

        function drawLoadingScreen() {
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#FFFFFF';
            ctx.font = '24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Loading...', canvas.width / 2, canvas.height / 2);
        }

        function drawTitleScreen() {
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#FFFFFF';
            ctx.font = 'bold 48px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('LEGODREAMS', canvas.width / 2, canvas.height / 2);
            ctx.font = '24px Arial';
            ctx.fillText('Tap to Start', canvas.width / 2, canvas.height / 2 + 50);
        }

        function drawGameOver() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'white';
            ctx.font = 'bold 48px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Game Over', canvas.width / 2, canvas.height / 2);
            ctx.font = '24px Arial';
            ctx.fillText(`Final Level: ${currentLevel}`, canvas.width / 2, canvas.height / 2 + 50);
            ctx.fillText('Tap to Restart', canvas.width / 2, canvas.height / 2 + 100);
        }

        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        function computerTouchesPlayer() {
            return Math.abs(computer.x - player.x) < 5 && Math.abs(computer.y - player.y) < 5;
        }

        function resetPositions() {
            player.x = 50;
            player.y = canvas.height / 2;
            computer.x = canvas.width - 80;
            computer.y = canvas.height / 2;
        }

        function resetGame() {
            playerScore = 0;
            computerScore = 0;
            resetPositions();
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        loadImages();
        gameLoop();
    </script>
</body>
</html>
